<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DidactaX — Structured Knowledge Creation Platform</title>
    
    <!-- CDN Links -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="css/main.css">
</head>
<body class="bg-gray-900 text-gray-100 font-oswald">
    <!-- Header -->
    <header id="app-header" class="hidden bg-gray-800 border-b border-gray-700 px-6 py-4 flex items-center justify-between sticky top-0 z-50">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-book text-white"></i>
                </div>
                <span class="text-xl font-bold text-white">DidactaX</span>
            </div>
            <nav class="flex items-center gap-4 ml-8">
                <a href="#" onclick="router('home'); return false;" class="nav-link px-4 py-2 rounded-lg hover:bg-gray-700 transition">Home</a>
                <a href="#" onclick="router('dashboard'); return false;" class="nav-link px-4 py-2 rounded-lg hover:bg-gray-700 transition">Dashboard</a>
                <a href="#" onclick="router('services'); return false;" class="nav-link px-4 py-2 rounded-lg hover:bg-gray-700 transition">Services</a>
                <a href="#" onclick="router('profile'); return false;" class="nav-link px-4 py-2 rounded-lg hover:bg-gray-700 transition">Profile</a>
            </nav>
        </div>
        <div class="flex items-center gap-4">
            <div id="book-representor" class="hidden px-4 py-2 bg-gray-700 rounded-lg">
                <span class="text-sm font-semibold">Book: <span id="current-book-name">-</span></span>
            </div>
            <button id="logout-btn" onclick="handleLogout()" class="hidden px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition">Logout</button>
            <button id="login-btn" onclick="router('auth'); return false;" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition">Login</button>
        </div>
    </header>

    <!-- Main App Container -->
    <div id="app-container" class="min-h-screen">
        <!-- Home Page View -->
        <div id="home-view" class="hidden">
            <!-- Hero Carousel -->
            <section class="relative h-screen overflow-hidden">
                <div id="hero-carousel" class="absolute inset-0">
                    <div class="carousel-slide active bg-gradient-to-br from-indigo-900 via-purple-900 to-gray-900 flex items-center justify-center">
                        <div class="text-center px-6 max-w-4xl">
                            <h1 class="text-6xl font-bold mb-6 text-white">Create Structured Knowledge</h1>
                            <p class="text-xl text-gray-300 mb-8">Transform ideas into comprehensive books and notes</p>
                            <button onclick="router('auth')" class="px-8 py-4 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-lg font-semibold transition">Get Started</button>
                        </div>
                    </div>
                    <div class="carousel-slide bg-gradient-to-br from-blue-900 via-indigo-900 to-gray-900 flex items-center justify-center">
                        <div class="text-center px-6 max-w-4xl">
                            <h1 class="text-6xl font-bold mb-6 text-white">Organize Your Learning</h1>
                            <p class="text-xl text-gray-300 mb-8">Build books with chapters, pages, and structured content</p>
                            <button onclick="router('auth')" class="px-8 py-4 bg-blue-600 hover:bg-blue-700 rounded-lg text-lg font-semibold transition">Start Creating</button>
                        </div>
                    </div>
                    <div class="carousel-slide bg-gradient-to-br from-purple-900 via-pink-900 to-gray-900 flex items-center justify-center">
                        <div class="text-center px-6 max-w-4xl">
                            <h1 class="text-6xl font-bold mb-6 text-white">Export & Share</h1>
                            <p class="text-xl text-gray-300 mb-8">Download as PDF or DOCX, share your knowledge</p>
                            <button onclick="router('auth')" class="px-8 py-4 bg-purple-600 hover:bg-purple-700 rounded-lg text-lg font-semibold transition">Join Now</button>
                        </div>
                    </div>
                </div>
                <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-2">
                    <button class="carousel-dot active w-3 h-3 rounded-full bg-white" onclick="goToSlide(0)"></button>
                    <button class="carousel-dot w-3 h-3 rounded-full bg-gray-500" onclick="goToSlide(1)"></button>
                    <button class="carousel-dot w-3 h-3 rounded-full bg-gray-500" onclick="goToSlide(2)"></button>
                </div>
            </section>

            <!-- Features Section -->
            <section class="py-20 px-6 bg-gray-800">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-4xl font-bold text-center mb-12">Features</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <i class="fas fa-book-open text-4xl text-indigo-400 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Book Creation</h3>
                            <p class="text-gray-400">Create comprehensive books with chapters, covers, and structured content</p>
                        </div>
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <i class="fas fa-file-alt text-4xl text-blue-400 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Single Page Notes</h3>
                            <p class="text-gray-400">Quick note-taking with structured sections and templates</p>
                        </div>
                        <div class="bg-gray-700 p-6 rounded-lg">
                            <i class="fas fa-download text-4xl text-purple-400 mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Export Options</h3>
                            <p class="text-gray-400">Download your work as PDF or DOCX formats</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="bg-gray-900 border-t border-gray-800 py-12 px-6">
                <div class="max-w-6xl mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                        <div>
                            <h4 class="font-bold mb-4">DidactaX</h4>
                            <p class="text-gray-400 text-sm">Structured knowledge creation platform</p>
                        </div>
                        <div>
                            <h4 class="font-bold mb-4">Features</h4>
                            <ul class="text-gray-400 text-sm space-y-2">
                                <li>Book Creation</li>
                                <li>Note Taking</li>
                                <li>Export Options</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold mb-4">Support</h4>
                            <ul class="text-gray-400 text-sm space-y-2">
                                <li>Documentation</li>
                                <li>Help Center</li>
                                <li>Contact Us</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold mb-4">Legal</h4>
                            <ul class="text-gray-400 text-sm space-y-2">
                                <li>Privacy Policy</li>
                                <li>Terms of Service</li>
                                <li>License</li>
                            </ul>
                        </div>
                    </div>
                    <div class="border-t border-gray-800 pt-8 text-center text-gray-400 text-sm">
                        <p>&copy; 2024 DidactaX. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        </div>

        <!-- Auth View -->
        <div id="auth-view" class="hidden min-h-screen flex items-center justify-center bg-gray-900 px-6">
            <div class="max-w-md w-full bg-gray-800 rounded-2xl p-8 shadow-2xl">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-book text-white text-2xl"></i>
                    </div>
                    <h2 id="auth-title" class="text-3xl font-bold mb-2">Welcome Back</h2>
                    <p id="auth-subtitle" class="text-gray-400">Sign in to continue</p>
                </div>
                <form id="auth-form" onsubmit="handleAuth(event)">
                    <div id="register-fields" class="hidden mb-4">
                        <input type="text" id="auth-name" placeholder="Full Name" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg mb-4 focus:outline-none focus:border-indigo-500">
                    </div>
                    <input type="email" id="auth-email" placeholder="Email" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg mb-4 focus:outline-none focus:border-indigo-500">
                    <input type="password" id="auth-password" placeholder="Password" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg mb-6 focus:outline-none focus:border-indigo-500">
                    <button type="submit" id="auth-submit" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold transition mb-4">Sign In</button>
                    <div class="text-center">
                        <button type="button" id="auth-toggle" onclick="toggleAuthMode()" class="text-indigo-400 hover:text-indigo-300 text-sm">Create an account</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="hidden min-h-screen p-6">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h1 class="text-4xl font-bold mb-2">Dashboard</h1>
                        <p class="text-gray-400">Manage your books and notes</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="bg-gray-800 px-6 py-3 rounded-lg">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-fire text-orange-500"></i>
                                <span class="font-semibold">Streak: <span id="streak-count">0</span> days</span>
                            </div>
                        </div>
                        <button onclick="showCreatePrompt()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-semibold transition">
                            <i class="fas fa-plus mr-2"></i>Create New
                        </button>
                    </div>
                </div>

                <div id="works-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Works will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Editor View (3-Panel Layout) -->
        <div id="editor-view" class="hidden h-screen flex">
            <!-- Left Panel: File Explorer -->
            <aside id="file-explorer" class="w-64 bg-gray-800 border-r border-gray-700 flex flex-col">
                <div class="p-4 border-b border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-sm uppercase text-gray-400">Files</h3>
                        <button onclick="createFolder()" class="text-gray-400 hover:text-white" title="New Folder">
                            <i class="fas fa-folder-plus"></i>
                        </button>
                    </div>
                    <button onclick="createFile()" class="w-full px-3 py-2 bg-indigo-600 hover:bg-indigo-700 rounded text-sm font-semibold mb-2">
                        <i class="fas fa-plus mr-2"></i>New File
                    </button>
                </div>
                <div id="file-tree" class="flex-1 overflow-y-auto p-4 custom-scrollbar">
                    <!-- File tree will be rendered here -->
                </div>
            </aside>

            <!-- Main Panel: Editor -->
            <main id="editor-main" class="flex-1 flex flex-col bg-gray-900">
                <!-- Editor Toolbar -->
                <div id="editor-toolbar" class="bg-gray-800 border-b border-gray-700 p-4">
                    <div class="flex items-center gap-2 flex-wrap">
                        <button onclick="formatText('bold')" class="toolbar-btn" title="Bold"><i class="fas fa-bold"></i></button>
                        <button onclick="formatText('italic')" class="toolbar-btn" title="Italic"><i class="fas fa-italic"></i></button>
                        <button onclick="formatText('underline')" class="toolbar-btn" title="Underline"><i class="fas fa-underline"></i></button>
                        <div class="w-px h-6 bg-gray-700 mx-1"></div>
                        <button onclick="formatText('justifyLeft')" class="toolbar-btn" title="Align Left"><i class="fas fa-align-left"></i></button>
                        <button onclick="formatText('justifyCenter')" class="toolbar-btn" title="Align Center"><i class="fas fa-align-center"></i></button>
                        <button onclick="formatText('justifyRight')" class="toolbar-btn" title="Align Right"><i class="fas fa-align-right"></i></button>
                        <div class="w-px h-6 bg-gray-700 mx-1"></div>
                        <button onclick="formatText('insertUnorderedList')" class="toolbar-btn" title="Bullet List"><i class="fas fa-list-ul"></i></button>
                        <button onclick="formatText('insertOrderedList')" class="toolbar-btn" title="Numbered List"><i class="fas fa-list-ol"></i></button>
                        <div class="w-px h-6 bg-gray-700 mx-1"></div>
                        <select onchange="formatText('formatBlock', this.value)" class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm">
                            <option value="p">Paragraph</option>
                            <option value="h1">Heading 1</option>
                            <option value="h2">Heading 2</option>
                            <option value="h3">Heading 3</option>
                        </select>
                        <input type="number" id="font-size" min="8" max="72" value="16" onchange="setFontSize(this.value)" class="w-16 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm" placeholder="Size">
                        <div class="w-px h-6 bg-gray-700 mx-1"></div>
                        <button onclick="formatText('foreColor', prompt('Enter color:', '#000000'))" class="toolbar-btn" title="Text Color"><i class="fas fa-palette"></i></button>
                        <button onclick="formatText('backColor', prompt('Enter background color:', '#ffffff'))" class="toolbar-btn" title="Background Color"><i class="fas fa-fill"></i></button>
                    </div>
                </div>

                <!-- Editor Content Area -->
                <div id="editor-content-area" class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                    <div id="single-page-form" class="hidden max-w-4xl mx-auto">
                        <!-- Single Page Input Form (10 sections) -->
                    </div>
                    <div id="book-form" class="hidden max-w-4xl mx-auto">
                        <!-- Book Creation Form -->
                    </div>
                    <div id="rich-editor" class="hidden">
                        <div id="editor" contenteditable="true" class="min-h-full bg-white text-gray-900 p-8 rounded-lg shadow-lg focus:outline-none" style="font-family: 'Oswald', sans-serif;"></div>
                    </div>
                </div>

                <!-- Footer Counter -->
                <div id="editor-footer" class="bg-gray-800 border-t border-gray-700 px-6 py-3 flex items-center justify-between text-sm">
                    <div class="flex items-center gap-6">
                        <span>Words: <span id="word-count">0</span></span>
                        <span>Characters: <span id="char-count">0</span></span>
                        <span>Paragraphs: <span id="para-count">0</span></span>
                        <span>Pages: <span id="page-count">0</span></span>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="saveCurrentWork()" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded text-sm font-semibold">
                            <i class="fas fa-save mr-2"></i>Save
                        </button>
                        <button onclick="downloadWork()" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded text-sm font-semibold">
                            <i class="fas fa-download mr-2"></i>Download
                        </button>
                    </div>
                </div>
            </main>

            <!-- Right Panel: Preview -->
            <aside id="preview-panel" class="w-80 bg-gray-800 border-l border-gray-700 flex flex-col">
                <div class="p-4 border-b border-gray-700">
                    <h3 class="font-bold text-sm uppercase text-gray-400">Preview</h3>
                </div>
                <div id="preview-content" class="flex-1 overflow-y-auto p-4 custom-scrollbar">
                    <!-- Preview will be rendered here -->
                </div>
            </aside>
        </div>

        <!-- Services View -->
        <div id="services-view" class="hidden min-h-screen p-6">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-4xl font-bold mb-8">Payment Services</h1>
                <div class="bg-gray-800 rounded-lg p-8">
                    <p class="text-gray-400 mb-6">To download PDF or DOCX files, please make a payment based on page count:</p>
                    <div class="space-y-4 mb-8">
                        <div class="bg-gray-700 p-4 rounded">
                            <p class="font-semibold mb-2">Pricing:</p>
                            <ul class="text-gray-400 text-sm space-y-1">
                                <li>• Up to 250 pages: 500 (local currency)</li>
                                <li>• Above 250 pages: 1000+ (based on page calculation)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <button onclick="initiatePayment('mtn')" class="p-6 bg-yellow-600 hover:bg-yellow-700 rounded-lg font-semibold">
                            <i class="fas fa-mobile-alt text-2xl mb-2"></i><br>MTN Mobile Money
                        </button>
                        <button onclick="initiatePayment('airtel')" class="p-6 bg-red-600 hover:bg-red-700 rounded-lg font-semibold">
                            <i class="fas fa-mobile-alt text-2xl mb-2"></i><br>Airtel Money
                        </button>
                        <button onclick="initiatePayment('bk')" class="p-6 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold">
                            <i class="fas fa-university text-2xl mb-2"></i><br>Bank Transfer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profile-view" class="hidden min-h-screen p-6">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-4xl font-bold mb-8">Profile & Settings</h1>
                <div class="bg-gray-800 rounded-lg p-8">
                    <div id="profile-content">
                        <!-- Profile content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Popup Modal -->
    <div id="custom-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
            <div id="popup-content"></div>
        </div>
    </div>

    <!-- Success Message Toast -->
    <div id="success-toast" class="hidden fixed bottom-6 right-6 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg z-50 flex items-center gap-3">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Success!</span>
    </div>

    <!-- Scripts -->
    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/fileManager.js"></script>
    <script src="js/forms.js"></script>
    <script src="js/payment.js"></script>
    <script src="js/router.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
